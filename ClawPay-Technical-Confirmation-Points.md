# ClawPay 技术实现确认点清单

> 基于产品需求文档 (PRD) 整理，需要在开发前明确的技术细节

---

## 目录

1. [链与基础设施选择](#1-链与基础设施选择)
2. [身份系统设计](#2-身份系统设计)
3. [智能合约架构](#3-智能合约架构)
4. [Escrow 托管机制](#4-escrow-托管机制)
5. [信誉系统设计](#5-信誉系统设计)
6. [定价模型实现](#6-定价模型实现)
7. [Agent SDK 设计](#7-agent-sdk-设计)
8. [安全与风控](#8-安全与风控)
9. [合规与法律](#9-合规与法律)
10. [运营与经济模型](#10-运营与经济模型)

---

## 1. 链与基础设施选择

### 1.1 主链选择

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| USD1 部署在哪条链？ | Ethereum / Sui / Solana / 多链 | ☐ |
| ClawPay 合约部署链 | 与 USD1 同链 / 独立部署 | ☐ |
| 是否需要跨链支持？ | 是 / 否 / 未来支持 | ☐ |

### 1.2 扩容方案

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 高频微支付如何处理？ | L2 (Arbitrum/Base/zkSync) / 状态通道 / 批量结算 | ☐ |
| 预期 TPS 是多少？ | < 100 / 100-1000 / > 1000 | ☐ |
| 单笔交易 Gas 成本预算 | < $0.01 / < $0.1 / 无限制 | ☐ |

### 1.3 节点与索引

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 使用哪个 RPC 提供商？ | Alchemy / Infura / QuickNode / 自建 | ☐ |
| 链上事件如何索引？ | The Graph / 自建索引器 / 第三方服务 | ☐ |
| 是否需要历史数据查询？ | 是 (多久？) / 否 | ☐ |

---

## 2. 身份系统设计

### 2.1 Root DID (人类身份)

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| DID 标准选择 | W3C DID / ENS / World ID / Lens / 自定义 | ☐ |
| 是否强制 KYC？ | 是 / 否 / 可选 | ☐ |
| KYC 提供商选择 | Jumio / Onfido / World ID / 其他 | ☐ |
| DID 存储位置 | 链上 / IPFS / 中心化服务器 | ☐ |

### 2.2 Sub-Agent DID (Agent 身份)

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| Agent DID 生成方式 | 派生自 Root / 独立生成 / 合约创建 | ☐ |
| 一个 Root 最多几个 Sub-Agent？ | 无限制 / 10 / 100 / 可配置 | ☐ |
| Sub-Agent 的密钥管理 | EOA / 智能账户(ERC-4337) / MPC / HSM | ☐ |
| Agent 可以转让给其他 Human 吗？ | 是 / 否 | ☐ |

### 2.3 身份验证流程

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| DID Handshake 协议 | Agent 间如何验证对方身份？链上还是链下？ | ☐ |
| 验证失败的处理 | 静默拒绝 / 返回错误 / 记录日志 | ☐ |
| 离线验证支持 | 是否支持离线签名验证？ | ☐ |

---

## 3. 智能合约架构

### 3.1 合约模块划分

| 模块 | 功能 | 是否需要 | 待确认 |
|------|------|----------|--------|
| Registry | DID 注册与查询 | ☐ 是 ☐ 否 | ☐ |
| Escrow | 资金托管 | ☐ 是 ☐ 否 | ☐ |
| Reputation | 信誉分存储与计算 | ☐ 是 ☐ 否 | ☐ |
| Pricing | 动态定价逻辑 | ☐ 是 ☐ 否 | ☐ |
| Arbiter | 仲裁与争议解决 | ☐ 是 ☐ 否 | ☐ |
| Treasury | 协议收入管理 | ☐ 是 ☐ 否 | ☐ |

### 3.2 可升级性

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 合约是否可升级？ | 是 (代理模式) / 否 (不可变) | ☐ |
| 升级权限归谁？ | 多签 / DAO / 单一管理员 | ☐ |
| 升级时间锁 | 无 / 24h / 48h / 7天 | ☐ |

### 3.3 权限模型

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 合约管理员角色有哪些？ | Owner / Operator / Pauser / 其他 | ☐ |
| 是否支持多签？ | 是 / 否，几/几？ | ☐ |
| 紧急暂停机制 | 是否需要？谁有权限？ | ☐ |

---

## 4. Escrow 托管机制

### 4.1 基础流程

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 创建 Escrow 时锁定多少资金？ | 全额 / Base_Price / Final_Price | ☐ |
| 资金锁定在哪里？ | 专用托管合约 / 统一资金池 | ☐ |
| 每个任务独立 Escrow 还是共享？ | 独立 / 共享池 + 记账 | ☐ |

### 4.2 任务完成判定

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 谁来判定任务完成？ | 买方确认 / 卖方声明 / 自动 / 预言机 | ☐ |
| 确认超时时间 | 1小时 / 24小时 / 7天 / 可配置 | ☐ |
| 超时后资金流向 | 退还买方 / 释放给卖方 / 进入仲裁 | ☐ |

### 4.3 争议仲裁

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 仲裁机制类型 | 中心化仲裁员 / DAO 投票 / Kleros / 自动规则 | ☐ |
| 仲裁费用谁出？ | 败诉方 / 双方分摊 / 协议补贴 | ☐ |
| 仲裁结果执行 | 自动执行 / 需确认 | ☐ |
| 上诉机制 | 是否支持？几轮？ | ☐ |

### 4.4 部分交付

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 是否支持里程碑付款？ | 是 / 否 | ☐ |
| 部分交付如何结算？ | 按比例 / 协商 / 预定义 | ☐ |

---

## 5. 信誉系统设计

### 5.1 信誉分计算

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 信誉分范围 | 0-100 / 0-1000 / 无上限 | ☐ |
| 初始信誉分 | 0 / 50 / 70 / 可配置 | ☐ |
| 信誉分计算公式 | 需要明确具体算法 | ☐ |

### 5.2 信誉分变动规则

| 事件 | 信誉影响 | 待确认 |
|------|----------|--------|
| 成功完成任务 | +? | ☐ |
| 被判定违约 | -? | ☐ |
| 超时未响应 | -? | ☐ |
| 发起无效争议 | -? | ☐ |
| 长期活跃加成 | +? | ☐ |

### 5.3 信誉防作弊

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| Sybil 攻击防护 | 如何防止刷信誉？ | ☐ |
| 信誉是否可转让/交易？ | 是 / 否 | ☐ |
| 信誉衰减机制 | 长期不活跃信誉是否下降？ | ☐ |
| 信誉冷启动 | 新用户如何获取初始信誉？ | ☐ |

### 5.4 信誉存储

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 信誉分存储位置 | 链上 / 链下 + 证明 | ☐ |
| 信誉历史是否保留？ | 是 (多久？) / 否 | ☐ |

---

## 6. 定价模型实现

### 6.1 公式参数确认

```
Final_Price = Base_Price × K_reputation × K_urgency × K_history
```

| 系数 | 取值范围 | 计算方式 | 待确认 |
|------|----------|----------|--------|
| K_reputation | 0.8 - 1.5 | 基于信誉分，具体公式？ | ☐ |
| K_urgency | 1.0 - 2.0 | 如何判定紧急？ | ☐ |
| K_history | 0.9 - 1.0 | 历史交易次数阈值？ | ☐ |

### 6.2 价格计算位置

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| 定价在哪里计算？ | 链上 / 链下 + 签名 / 预言机 | ☐ |
| 价格是否可协商？ | 固定 / 可议价 / 拍卖 | ☐ |
| 价格争议如何处理？ | 以锁定价格为准 / 可仲裁 | ☐ |

### 6.3 溢价处理

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 溢价锁定比例 | 低信誉方溢价多少锁定？ | ☐ |
| 溢价退还比例 | 成功完成后退多少？(文档说80%) | ☐ |
| 溢价销毁/金库比例 | 剩余20%如何分配？ | ☐ |

---

## 7. Agent SDK 设计

### 7.1 支持语言

| 语言 | 优先级 | 待确认 |
|------|--------|--------|
| TypeScript/JavaScript | ☐ P0 ☐ P1 ☐ P2 | ☐ |
| Python | ☐ P0 ☐ P1 ☐ P2 | ☐ |
| Rust | ☐ P0 ☐ P1 ☐ P2 | ☐ |
| Go | ☐ P0 ☐ P1 ☐ P2 | ☐ |

### 7.2 核心 API 设计

| API 功能 | 是否需要 | 待确认 |
|----------|----------|--------|
| `createAgent(rootDID, config)` | ☐ 是 ☐ 否 | ☐ |
| `verifyIdentity(targetDID)` | ☐ 是 ☐ 否 | ☐ |
| `createEscrow(taskId, amount, recipient)` | ☐ 是 ☐ 否 | ☐ |
| `releaseEscrow(taskId)` | ☐ 是 ☐ 否 | ☐ |
| `disputeEscrow(taskId, reason)` | ☐ 是 ☐ 否 | ☐ |
| `getReputation(did)` | ☐ 是 ☐ 否 | ☐ |
| `calculatePrice(basePrice, params)` | ☐ 是 ☐ 否 | ☐ |
| `subscribeEvents(filters, callback)` | ☐ 是 ☐ 否 | ☐ |

### 7.3 签名与授权

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| Agent 如何签名交易？ | 本地私钥 / 远程签名服务 / 智能账户 | ☐ |
| Mandate 授权格式 | EIP-712 / 自定义 / 链上批准 | ☐ |
| 授权有效期 | 永久 / 时间限制 / 单次 | ☐ |

### 7.4 错误处理与重试

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 交易失败重试策略 | 次数？间隔？指数退避？ | ☐ |
| Nonce 管理 | SDK 内置 / 用户管理 | ☐ |
| 错误码标准 | 需要定义错误码体系 | ☐ |

---

## 8. 安全与风控

### 8.1 智能合约安全

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 是否需要第三方审计？ | 是 / 否，哪家？ | ☐ |
| 审计预算 | $? | ☐ |
| Bug Bounty 计划 | 是否启动？奖金范围？ | ☐ |

### 8.2 风险场景

| 风险 | 缓解方案 | 待确认 |
|------|----------|--------|
| 重入攻击 | Checks-Effects-Interactions | ☐ |
| 闪电贷攻击 | 是否需要防护？ | ☐ |
| MEV 抢跑 | 私有内存池 / Flashbots | ☐ |
| 预言机操纵 | 多数据源 / TWAP | ☐ |
| 合约漏洞导致资金损失 | 保险？上限？ | ☐ |

### 8.3 限额与熔断

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 单笔交易上限 | $? USD1 | ☐ |
| 单日交易上限 | $? USD1 | ☐ |
| 异常交易检测 | 规则是什么？ | ☐ |
| 熔断触发条件 | 什么情况下暂停协议？ | ☐ |

---

## 9. 合规与法律

### 9.1 牌照需求

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 资金托管是否需要牌照？ | 需要法律意见 | ☐ |
| 目标市场 | 美国 / 欧盟 / 亚洲 / 全球 | ☐ |
| 是否需要 MSB/MTL？ | 需要法律意见 | ☐ |
| 是否适用 MiCA？ | 需要法律意见 | ☐ |

### 9.2 KYC/AML

| 确认项 | 选项 | 待确认 |
|--------|------|--------|
| KYC 强制程度 | 全部 / 大额 / 可选 / 无 | ☐ |
| AML 筛查 | 是否集成 Chainalysis/Elliptic？ | ☐ |
| 制裁名单筛查 | OFAC / EU / UN | ☐ |

### 9.3 数据隐私

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 用户数据存储位置 | 链上 / 链下 / 混合 | ☐ |
| GDPR 合规 | 是否需要？如何实现删除权？ | ☐ |
| 数据保留期限 | 多久？ | ☐ |

---

## 10. 运营与经济模型

### 10.1 收入模式

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 协议如何盈利？ | 手续费 / 溢价分成 / 订阅 / 其他 | ☐ |
| 手续费率 | ?% 每笔 | ☐ |
| 费用谁承担？ | 买方 / 卖方 / 双方 | ☐ |

### 10.2 代币经济 (如适用)

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 是否发行治理代币？ | 是 / 否 | ☐ |
| 代币用途 | 治理 / 质押 / 手续费折扣 / 其他 | ☐ |
| 代币分配 | 需要详细方案 | ☐ |

### 10.3 冷启动策略

| 确认项 | 描述 | 待确认 |
|--------|------|--------|
| 如何吸引第一批 Agent？ | 补贴 / 合作 / 空投 | ☐ |
| 初始流动性来源 | 自有资金 / 融资 / 合作伙伴 | ☐ |
| 早期用户激励 | 是否有特殊优惠？ | ☐ |

---

## 11. 开发路线图确认

### 11.1 MVP 范围

| 功能 | 是否包含在 MVP | 待确认 |
|------|----------------|--------|
| Root DID 注册 | ☐ 是 ☐ 否 | ☐ |
| Sub-Agent 创建 | ☐ 是 ☐ 否 | ☐ |
| 基础 Escrow | ☐ 是 ☐ 否 | ☐ |
| 信誉系统 | ☐ 是 ☐ 否 | ☐ |
| 动态定价 | ☐ 是 ☐ 否 | ☐ |
| 仲裁系统 | ☐ 是 ☐ 否 | ☐ |
| 管理后台 | ☐ 是 ☐ 否 | ☐ |
| Agent SDK | ☐ 是 ☐ 否 | ☐ |

### 11.2 技术栈确认

| 层级 | 待确认技术选型 |
|------|----------------|
| 智能合约 | Solidity / Move / Rust | ☐ |
| 后端服务 | Node.js / Go / Rust | ☐ |
| 数据库 | PostgreSQL / MongoDB / 链上 | ☐ |
| 前端 | React / Vue / Next.js | ☐ |
| 索引服务 | The Graph / 自建 | ☐ |

---

## 12. 待确认项汇总

### 🔴 P0 - 必须在开发前确认

1. [ ] USD1 部署链及 ClawPay 合约部署链
2. [ ] 高频交易的扩容方案 (L2/状态通道)
3. [ ] DID 标准选择 (W3C/ENS/World ID)
4. [ ] Agent 密钥管理方案 (EOA/AA/MPC)
5. [ ] 任务完成判定机制
6. [ ] 仲裁机制设计
7. [ ] 初始信誉分与冷启动策略
8. [ ] 合规法律意见 (托管牌照需求)

### 🟡 P1 - 开发早期需确认

9. [ ] 定价公式各系数具体数值
10. [ ] Escrow 超时时间
11. [ ] 信誉分计算详细公式
12. [ ] SDK 优先支持语言
13. [ ] 合约升级策略
14. [ ] 安全审计预算与时间

### 🟢 P2 - 可迭代确认

15. [ ] 代币经济设计
16. [ ] 跨链支持
17. [ ] 高级仲裁功能
18. [ ] 数据分析后台

---

## 附录：建议的下一步

1. **召开技术评审会** - 与产品、法务、安全团队一起过一遍此清单
2. **输出技术规格文档** - 针对每个 P0 项输出详细设计
3. **选择技术栈** - 确定链、语言、框架
4. **设计系统架构图** - 画出完整的系统交互图
5. **制定开发计划** - 根据 MVP 范围排期

---

*文档生成时间: 2026-02-05*
*版本: v0.1*
